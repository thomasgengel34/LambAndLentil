@model LambAndLentil.UI.Models.RecipeVM
@using LambAndLentil.UI.Models;

@{

    ViewBag.Title = "Edit";
    SelectList ingredientNames = (SelectList)ViewBag.ingredientNames;

    SelectList ingreds = (SelectList)ViewBag.ingreds;
    
    int ID = Model.ID;


}

<h2>Edit a Recipe</h2>
@using (Html.BeginForm("Edit", "Recipes", new { ID = ID }))
{

    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.ID)

        <div class="form-group">
            @Html.BootstrapLabelFor(model => model.Name )
            <div class="col-md-10">
                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.BootstrapLabelFor(model => model.Description )
            <div class="col-md-10">
                @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.BootstrapLabelFor(model => model.Servings )
            <div class="col-md-10">
                @Html.EditorFor(model => model.Servings, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Servings, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.BootstrapLabelFor(model => model.MealType )
            <div class="col-md-10">
                @Html.EnumDropDownListFor(model => model.MealType, htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.MealType, "", new { @class = "text-danger" })
            </div>
        </div>

    </div>
    <div class="form-group">

        <div>
            <input type="submit" value="Save Changes" class="btn btn-default" />
        </div>
    </div>
}
<hr />
<h4>Ingredients in @Model.Name</h4>

<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(m => m.RecipeIngredients.First().Ingredient.Name)
        </th>
        <th>
            @Html.DisplayNameFor(m => m.RecipeIngredients.First().Quantity)

        </th>
        <th>
            @Html.DisplayNameFor(m => m.RecipeIngredients.First().Ingredient.ServingSizeUnit)
        </th>
        <th>
            @Html.DisplayNameFor(m => m.RecipeIngredients.First().Ingredient.Calories)
        </th>
        <th>
            @Html.DisplayNameFor(m => m.RecipeIngredients.First().Ingredient.CalFromFat)
        </th>
        <th></th>
    </tr>
    @if (Model.RecipeIngredients != null || Model.RecipeIngredients.Count > 0)
    {
        foreach (var item in Model.RecipeIngredients)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Ingredient.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Quantity)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Measurement)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Ingredient.Calories)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Ingredient.CalFromFat)
                </td>
                <td>
                   
                    @using (Html.BeginForm("RemoveIngredient", "Recipes", new { ID = ID, recipeID = item.ID }))
                    {
                        @Html.AntiForgeryToken()
                        <input type="submit" value="Remove Ingredient" class="btn btn-default" />
                    }
                    @using (Html.BeginForm("ReplaceIngredient", "Recipes", new { ID = ID, oldID = item.ID }))
                    {
                        //string ingredientsd = ingredientNames.Items[0].Value.ToString //<<<<<<<<<
                        @Html.AntiForgeryToken()
                        <p>
                            Select a new ingredient: @Html.DropDownList("ingredientsd", ingredientNames,"choose" )
                            Quantity:
                            @Html.EditorFor(m => m.RecipeIngredients.FirstOrDefault().Quantity)

                            @Html.EnumDropDownListFor(m => m.RecipeIngredients.FirstOrDefault().Measurement, htmlAttributes: new { @class = "form-control" })

                        </p> 

                    <input type="submit" value="Replace Ingredient" class="btn btn-default" />

                    }
                </td>
            </tr>
                        }
                    }
</table>
<div>

  

    @using (Html.BeginForm("AddIngredient", "Recipes", new { ID = ID }))
    {
        @Html.AntiForgeryToken()
        <p>
            @*Select an ingredient to add: @Html.DropDownList("IngredientName", ingredientNames, "choose")
            Quantity:
            @Html.EditorFor(m => m.RecipeIngredients.FirstOrDefault().Quantity)

            @Html.EnumDropDownListFor(m => m.RecipeIngredients.FirstOrDefault().Measurement, htmlAttributes: new { @class = "form-control" })*@

        </p>

        <div class="form-group">
            <div>
                <input type="submit" value="Add Ingredient" class="btn btn-default" />
            </div>
        </div>



        <div class="row">
            <div class="col-md-6">
                @Html.ActionLink("Back to List", "Index")
            </div>
            <div class="col-md-6"></div>
         
            Total Calories  
            @Html.Label(Model.Calories.ToString())
        </div>


    }
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
